echo 'deb-src http://deb.debian.org/debian stretch main' >> /etc/apt/sources.list
echo 'deb-src http://security.debian.org/debian-security stretch/updates main' >> /etc/apt/sources.list
echo 'deb-src http://deb.debian.org/debian stretch-updates main' >> /etc/apt/sources.list

sudo dpkg --add-architecture i386

sudo apt-get update
sudo apt-get -y install wget git
sudo apt-get -y build-dep wine

#### 64 bits
sudo apt-get -y install libva-dev libkrb5-dev opencl-dev libpcap-dev libsane-dev libv4l-dev libgphoto2-dev libtiff-dev libpulse-dev libgstreamer1.0-dev libudev-dev libcapi20-dev libgstreamer-plugins-base1.0-dev

# Wine Staging
sudo apt-get -y install gtk3.0-dev libgtk-3-dev libva-dev
sudo apt-get -y install libvulkan-dev
sudo apt-get -y install libavcodec-dev
sudo apt-get -y install libdbus-1-dev fcitx-libs-dev libsamplerate0-dev libibus-1.0-dev
sudo apt-get -y install mingw-w64

# VKD3D
mkdir -p /home/runner/work/netdisk/netdisk/build-wine/vkd3d-64
cd /home/runner/work/netdisk/netdisk/build-wine/vkd3d-64
wget http://cdn-fastly.deb.debian.org/debian/pool/main/v/vulkan/libvulkan1_1.1.70+dfsg1-1~bpo9+1_amd64.deb
wget http://deb.debian.org/debian/pool/main/v/vkd3d/libvkd3d-dev_1.1-3_amd64.deb
wget http://deb.debian.org/debian/pool/main/v/vkd3d/libvkd3d1_1.1-3_amd64.deb
wget http://ftp.de.debian.org/debian/pool/main/v/vkd3d/libvkd3d-utils1_1.1-3_amd64.deb
wget http://cdn-fastly.deb.debian.org/debian/pool/main/v/vulkan/libvulkan-dev_1.1.70+dfsg1-1~bpo9+1_amd64.deb
sudo dpkg -i *.deb

#OSSv4
mkdir -p /home/runner/work/netdisk/netdisk/build-wine/ossv4
cd /home/runner/work/netdisk/netdisk/build-wine/ossv4
wget http://deb.debian.org/debian/pool/main/o/oss4/oss4-dev_4.2-build2010-2_all.deb
sudo dpkg -i *.deb

# SDL (for FAudio)
mkdir -p /home/runner/work/netdisk/netdisk/build-wine/sdl2/x86
mkdir -p /home/runner/work/netdisk/netdisk/build-wine/sdl2/x64
cd /home/runner/work/netdisk/netdisk/build-wine/sdl2
wget https://www.libsdl.org/release/SDL2-2.0.9.tar.gz
tar -xvf SDL2-2.0.9.tar.gz -C x86/
tar -xvf SDL2-2.0.9.tar.gz -C x64/
cd /home/runner/work/netdisk/netdisk/build-wine/sdl2/x64/SDL2-2.0.9/
./configure --prefix="/usr/"
make
sudo make install

# Faudio
sudo apt-get update
sudo apt-get -y install cmake
mkdir -p /home/runner/work/netdisk/netdisk/build-wine/faudio
cd /home/runner/work/netdisk/netdisk/build-wine/faudio
git clone https://github.com/FNA-XNA/FAudio
mkdir -p /home/runner/work/netdisk/netdisk/build-wine/faudio/build64
mkdir -p /home/runner/work/netdisk/netdisk/build-wine/faudio/build32
cd /home/runner/work/netdisk/netdisk/build-wine/faudio/build64
cmake /home/runner/work/netdisk/netdisk/build-wine/faudio/FAudio
make
sudo make install

#### 32 bits
echo "#/bin/bash" > /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh
echo sudo apt-get update >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh
echo sudo apt-get -y remove gir1.2-ibus-1.0:amd64 libsane-dev:amd64 >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh
echo sudo apt-get -y build-dep wine >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh
# Wine Staging
echo sudo apt-get -y install libva-dev:i386 >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh
echo sudo apt-get -y install libavcodec-dev:i386 >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh
# Vulkan
echo sudo apt-get -y install libvulkan-dev:i386 >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh

# VKD3D
mkdir -p /home/runner/work/netdisk/netdisk/build-wine/vkd3d-32
cd /home/runner/work/netdisk/netdisk/build-wine/vkd3d-32
wget http://cdn-fastly.deb.debian.org/debian/pool/main/v/vulkan/libvulkan1_1.1.70+dfsg1-1~bpo9+1_i386.deb
wget http://deb.debian.org/debian/pool/main/v/vkd3d/libvkd3d-dev_1.1-3_i386.deb
wget http://deb.debian.org/debian/pool/main/v/vkd3d/libvkd3d1_1.1-3_i386.deb
wget http://ftp.de.debian.org/debian/pool/main/v/vkd3d/libvkd3d-utils1_1.1-3_i386.deb
wget http://cdn-fastly.deb.debian.org/debian/pool/main/v/vulkan/libvulkan-dev_1.1.70+dfsg1-1~bpo9+1_i386.deb
echo sudo dpkg -i /home/runner/work/netdisk/netdisk/build-wine/vkd3d-32/*.deb >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh

echo sudo apt-get -y install libsane-dev:i386 libpcap0.8-dev:i386 libicu-dev:i386 g++-multilib  libglib2.0-dev:i386 libpulse-dev:i386 libfontconfig1-dev:i386 libopenal-dev:i386 libldap-dev:i386 libkrb5-dev:i386 libgsm1-dev:i386 fontconfig:i386 libncurses-dev:i386 liblcms2-dev:i386 libxcomposite-dev:i386 libosmesa-dev:i386 libmpg123-dev:i386 libxslt-dev:i386 libxml2-dev:i386 libgnutls28-dev:i386 libfreetype6-dev:i386 opencl-dev:i386  libv4l-dev:i386 libgphoto2-dev:i386 libtiff-dev:i386 libudev-dev:i386 libcapi20-dev:i386 >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh

echo sudo apt-get -y install libwayland-dev:i386 libwayland-egl1-mesa:i386 libxkbcommon-dev:i386 libxcursor-dev:i386 libxi-dev:i386 libxrandr-dev:i386 libxinerama-dev:i386 libglu1-mesa-dev:i386 libdbus-1-dev:i386 fcitx-libs-dev:i386 libsamplerate0-dev:i386 libibus-1.0-dev:i386 >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh

#SDL (for FAudio)
echo "cd /home/runner/work/netdisk/netdisk/build-wine/sdl2/x86/SDL2-2.0.9/" >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh
echo "./configure --build=i386-pc-linux-gnu CFLAGS=\"-m32\" CXXFLAGS=\"-m32\" LDFLAGS=\"-m32\" --prefix=\"/usr/\"" >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh
echo "make" >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh
echo "sudo make install" >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh


# Faudio
echo sudo apt-get -y --force-yes install gtk3.0-dev:i386 libgtk-3-dev:i386 libgstreamer1.0-dev:i386 libgstreamer-plugins-base1.0-dev:i386 >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh
echo "cd /home/runner/work/netdisk/netdisk/build-wine/faudio/build32" >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh
echo "cmake -DCMAKE_C_FLAGS=\"-m32 -I/usr/include/SDL2\" /home/runner/work/netdisk/netdisk/build-wine/faudio/FAudio" >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh
echo "make" >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh
echo "sudo make install" >> /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh


chmod +x /home/runner/work/netdisk/netdisk/build-wine/install_32bits_dependencies.sh


